<!DOCTYPE html>
<html>

<head>
    <title>INTERSECTION LIST</title>
</head>

<body>
    PRIMERA LISTA:
    <ul id="lista1">
        <li>manzana</li>
        <li>pera</li>
        <ul>
            <li>conferencia</li>
            <ul>
                <li>conferenciaverde</li>
                <li>conferenciaamarilla</li>
                <li>conferenciaroja</li>
            </ul>
            <li>peradeagua</li>
            <li>peritadulce</li>
            <ul>
                <li>Dimas</li>
                <li>Gestas</li>
                <li>Malakatos</li>
                <li>Jose</li>
            </ul>
        </ul>
        <li>limon</li>
        <li>limon</li>
        <li>LIMON</li>
    </ul>
    Segunda lista:
    <ul id="lista2">
        <li>manzana</li>
        <li>manzana</li>
        <li>manzana</li>
        <li>manzana</li>
        <li>pera</li>
        <li>limon</li>
    </ul>


    <script>

        // Listas que se van a rellenar con los nodos
        var lista1 = [];
        var lista2 = [];
        var lista3 = [];

        // Inserta las listas del DOM 
        // Le pasas el padre(UL lista1) y el array vacio
        const inserta = (padre, arr) => {
            // Si el nodo es un li, lo mete en el array
            if (padre.nodeName == "LI") {
                arr.push(padre.innerHTML.toUpperCase())
            } else {
                // Si el nodo es UL lo recorre las veces que tenga li la ul
                for (let i = 0; i < padre.children.length; i++) {
                    // En cada li llama a la funcion
                    inserta(padre.children[i], arr)
                    // Si hubiera otro UL dentro lo volveria a enviar al bucle
                }
            }
        }

        // Llamo a la funcion pasandole el padre y la lista que quiero rellenar con este
        inserta(document.getElementById("lista1"), lista1);
        inserta(document.getElementById("lista2"), lista2);

        // Ordenar la lista para quitar los duplicados, será más facil porque estarán juntos
        lista1.sort();
        // Cojo los que sean diferentes al anterior
        lista1 = lista1.filter((_, i, arr) => i == 0 || arr[i] != arr[i - 1])

        lista2.sort();
        lista2 = lista2.filter((_, i, arr) => i == 0 || arr[i] != arr[i - 1])

        // console.log(lista1)
        // console.log(lista2)

        // Meto en la lista 3 la lista 1 y 2 ordenadas y sin duplicados
        lista3 = lista1.concat(lista2);

        // Ordeno la lista 3
        lista3.sort();

        // Quitar los duplicados igual que antes por si acaso
        lista3 = lista3.filter((_, i, arr) => i == 0 || arr[i] != arr[i - 1])

        console.log(lista3)

    </script>

</body>

</html>